# ğŸŒ VPS-Tailscale-DERP-AutoSetup

> ä¸€é”®éƒ¨ç½²å±äºä½ è‡ªå·±çš„ **Tailscale DERP ä¸­ç»§æœåŠ¡å™¨**  
> è‡ªåŠ¨ç”³è¯· SSL è¯ä¹¦ã€è‡ªåŠ¨æ›´æ–°ã€ä¸­æ–‡äº¤äº’ã€æ°¸ä¹…å…è´¹ä½¿ç”¨  
> ğŸ§° é€‚ç”¨äºï¼šä¸ªäººè‡ªç”¨ã€è‡ªå»ºåŠ é€Ÿã€è·¨è®¾å¤‡è¿æ¥ä¼˜åŒ–

---

## âœ³ï¸ å·¥å…·ç®€ä»‹

`VPS-Tailscale-DERP-AutoSetup` æ˜¯ä¸€ä¸ªä¸ºä¸ªäººç”¨æˆ·è®¾è®¡çš„  
**Tailscale DERP ä¸€é”®éƒ¨ç½²ä¸ç®¡ç†å·¥å…·**ã€‚

é€šè¿‡å®ƒï¼Œä½ å¯ä»¥åœ¨ä»»æ„ VPSï¼ˆé˜¿é‡Œäº‘ / è…¾è®¯äº‘ / Google Cloud / AWSï¼‰ä¸Šï¼Œ  
å‡ åˆ†é’Ÿå†…æ­å»ºä¸€ä¸ª **å®Œå…¨å±äºè‡ªå·±çš„ DERP ä¸­ç»§æœåŠ¡å™¨**ï¼Œ  
å®ç°ï¼š
- ğŸŒ è®¾å¤‡ä¹‹é—´æ›´å¿«çš„ Tailscale è¿æ¥  
- ğŸ”’ å®Œå…¨è‡ªæ§çš„æ•°æ®ä¸­è½¬ï¼ˆä¸ç»è¿‡ Tailscale å®˜æ–¹æœåŠ¡å™¨ï¼‰  
- âš™ï¸ è‡ªåŠ¨ SSL è¯ä¹¦ä¸è‡ªåŠ¨æ›´æ–°æœºåˆ¶  
- ğŸ§© å‘½ä»¤è¡Œä¸­æ–‡èœå•ç®¡ç†ï¼ˆå‘½ä»¤ï¼š`td`ï¼‰

---

## âš¡ ä¸ºä»€ä¹ˆä¸ªäººåªéœ€è¦æ­å»ºä¸€ä¸ª DERP æœåŠ¡å°±è¶³å¤Ÿäº†ï¼Ÿ

Tailscale é»˜è®¤ä½¿ç”¨å…¨çƒåˆ†å¸ƒçš„å®˜æ–¹ DERP ä¸­ç»§èŠ‚ç‚¹ã€‚  
ä½†å¯¹äºä¸ªäººç”¨æˆ·æ¥è¯´ï¼Œå­˜åœ¨ä»¥ä¸‹é—®é¢˜ï¼š

| å®˜æ–¹ DERP | è‡ªå»º DERP |
|------------|------------|
| ğŸŒ€ èŠ‚ç‚¹åœ¨å¢ƒå¤–ï¼Œå»¶è¿Ÿè¾ƒé«˜ | âš¡ éƒ¨ç½²åœ¨è‡ªå·±é™„è¿‘ï¼ˆå¦‚é˜¿é‡Œäº‘/è…¾è®¯äº‘ï¼‰ |
| ğŸ”’ æ•°æ®ä¸­è½¬ç»è¿‡ç¬¬ä¸‰æ–¹æœåŠ¡å™¨ | ğŸ” æ•°æ®åªç»è¿‡ä½ è‡ªå·±çš„ VPS |
| ğŸ’¸ æ— æ³•å®šåˆ¶ä¼˜å…ˆè·¯ç”± | ğŸ§  å¯å®Œå…¨æŒæ§è·¯å¾„ä¸å¸¦å®½ |
| âš™ï¸ æ— æ³•è„±ç¦»å®˜æ–¹æ§åˆ¶é¢ | âœ… å¯ç»“åˆè‡ªå»º Headscale å®Œå…¨ç‹¬ç«‹ï¼ˆå¯é€‰ï¼‰ |

> âœ… ä¸ªäººä½¿ç”¨åœºæ™¯ä¸‹ï¼Œåªè¦ä½ éƒ¨ç½² **ä¸€ä¸ª DERP èŠ‚ç‚¹**ï¼ˆä¾‹å¦‚éƒ¨ç½²åœ¨ä½ å¸¸ç”¨çš„ VPS ä¸Šï¼‰ï¼Œ  
> å°±èƒ½æå¤§æå‡è¿æ¥é€Ÿåº¦ï¼Œå¹¶ç¡®ä¿æ•°æ®è·¯å¾„å¯æ§ã€‚  
> å› ä¸º Tailscale åœ¨ç›´è¿å¤±è´¥æ—¶ï¼Œåªä¼šä½¿ç”¨ä½ è‡ªå»ºçš„ DERP èŠ‚ç‚¹è¿›è¡Œä¸­ç»§ï¼Œ  
> æ‰€ä»¥ä¸€ä¸ªèŠ‚ç‚¹å³å¯è¦†ç›–ä½ æ‰€æœ‰è®¾å¤‡ã€‚

## âš™ï¸ å®‰è£…å‰å‡†å¤‡

åœ¨è¿è¡Œæ­¤å·¥å…·ä¹‹å‰ï¼Œè¯·ç¡®ä¿ï¼š

| é¡¹ç›® | è¯´æ˜ |
|------|------|
| âœ… ä¸€å° VPS | å»ºè®®ä½¿ç”¨ Debian 12 æˆ– Ubuntu 22+ |
æ›´æ–°ç³»ç»Ÿæº & è½¯ä»¶åŒ…
```bash
apt update && apt upgrade -y
å®‰è£…å¸¸ç”¨åŸºç¡€å‘½ä»¤ï¼ˆéå¸¸é‡è¦ï¼‰
```bash
apt install -y curl wget git unzip vim nano htop jq net-tools dnsutils ca-certificates lsb-release cron
è®¾ç½®æ—¶åŒºä¸æ—¶é—´åŒæ­¥ï¼ˆé˜²æ­¢è¯ä¹¦ç­¾å‘å¤±è´¥ï¼‰
```bash
timedatectl set-timezone Asia/Shanghai
```bash
apt install -y systemd-timesyncd
systemctl enable --now systemd-timesyncd
timedatectl timesync-status
å¼€å¯ TCP BBR åŠ é€Ÿï¼ˆæå‡ç½‘ç»œååï¼‰
```bash
echo "net.core.default_qdisc=fq" >> /etc/sysctl.conf
echo "net.ipv4.tcp_congestion_control=bbr" >> /etc/sysctl.conf
sysctl -p
æ¸…ç†æ— ç”¨ç¼“å­˜ï¼ˆä¿æŒç³»ç»Ÿå¹²å‡€ï¼‰
```bash
apt autoremove -y && apt clean
é‡å¯ä¸€æ¬¡ï¼ˆè®©æ‰€æœ‰å†…æ ¸å‚æ•°ç”Ÿæ•ˆï¼‰
```bash
reboot
| âœ… å…¬ç½‘ IP | å¿…é¡»ä¸ºå…¬ç½‘å¯è®¿é—®åœ°å€ |
| âœ… ä¸€ä¸ªå·²å¤‡æ¡ˆçš„åŸŸå | ç¤ºä¾‹ï¼š`xxxxxx.top` |
| âœ… åŸŸåæ‰˜ç®¡åœ¨ Cloudflare | å…è´¹ã€æ”¯æŒ DNS API |
| âœ… å·²åœ¨ Cloudflare æ·»åŠ  A è®°å½• | å°† `derp.xxxxxx.top` æŒ‡å‘ä½ çš„ VPS IP |
| âš ï¸ å…³é—­ä»£ç†ï¼ˆç°äº‘ï¼‰ | ä»… DNS æ¨¡å¼ï¼Œå¦åˆ™ SSL ç”³è¯·å¤±è´¥ |
| âœ… 443 ç«¯å£å¼€æ”¾ | ç”¨äº HTTPS ä¸ STUN æœåŠ¡ |

## ğŸš€ ä¸€é”®å®‰è£…å‘½ä»¤

> âš ï¸ è¯·ä½¿ç”¨ root ç”¨æˆ·æ‰§è¡Œï¼ˆæˆ– sudo è¿è¡Œï¼‰

```bash
bash <(curl -fsSL https://raw.githubusercontent.com/bobvane/VPS-Tailscale-DERP-AutoSetup/main/install.sh)

å®‰è£…è¿‡ç¨‹å°†è‡ªåŠ¨ï¼š

æ£€æµ‹ç³»ç»Ÿç‰ˆæœ¬ä¸ IPï¼›

æ£€æŸ¥ Cloudflare DNSï¼›

ä¸‹è½½å¹¶å®‰è£…æœ€æ–°ç‰ˆ tailscale ä¸ derperï¼›

è‡ªåŠ¨ç”³è¯· Letâ€™s Encrypt è¯ä¹¦ï¼›

æ³¨å†Œ systemd æœåŠ¡ï¼›

è®¾ç½®æ¯å‘¨è‡ªåŠ¨æ›´æ–°ä»»åŠ¡ï¼›

å®‰è£…å‘½ä»¤è¡Œç®¡ç†å·¥å…· tdã€‚

ğŸ§° å‘½ä»¤è¡Œç®¡ç†å·¥å…· td

å®‰è£…å®Œæˆåï¼Œä½ å¯ä»¥é€šè¿‡å‘½ä»¤ï¼š

td


æ‰“å¼€äº¤äº’å¼ç®¡ç†èœå•ï¼š

===========================================
 Tailscale DERP ç®¡ç†å·¥å…·
-------------------------------------------
 1. å¯åŠ¨ DERP æœåŠ¡
 2. åœæ­¢ DERP æœåŠ¡
 3. é‡å¯ DERP æœåŠ¡
 4. æŸ¥çœ‹è¿è¡ŒçŠ¶æ€
 5. ä¿®æ”¹ç»‘å®šåŸŸå
 6. ä¿®æ”¹ç›‘å¬ç«¯å£
 7. é‡æ–°ç”³è¯· SSL è¯ä¹¦
 8. æ‰‹åŠ¨æ›´æ–° derper/tailscale
 9. æŸ¥çœ‹æ—¥å¿—
10. é€€å‡º
===========================================

ğŸ§© æœåŠ¡è¿è¡Œä¸éªŒè¯
æ£€æŸ¥æœåŠ¡æ˜¯å¦æ­£å¸¸è¿è¡Œ
systemctl status derper


è¾“å‡ºä¸­å‡ºç°ï¼š

Active: active (running)


è¡¨ç¤ºè¿è¡ŒæˆåŠŸã€‚

éªŒè¯ DERP èŠ‚ç‚¹åœ¨å·¥ä½œ

åœ¨ä»»æ„ Tailscale å®¢æˆ·ç«¯è¿è¡Œï¼š

tailscale netcheck


è‹¥è¾“å‡ºåŒ…å«ï¼š

DERP region: derp.bobvane.top


è¯´æ˜è‡ªå»ºä¸­ç»§å·²å¯ç”¨ã€‚

ğŸ” è‡ªåŠ¨æ›´æ–°æœºåˆ¶

æœ¬å·¥å…·è‡ªå¸¦è‡ªåŠ¨æ›´æ–°åŠŸèƒ½ï¼Œæ¯å‘¨ä¸€å‡Œæ™¨ 05:00 è‡ªåŠ¨æ‰§è¡Œï¼š

æ£€æŸ¥ Tailscale æœ€æ–°ç‰ˆ

æ£€æŸ¥ DERPER æœ€æ–°ç‰ˆ

è‡ªåŠ¨ä¸‹è½½æ›´æ–°å¹¶é‡å¯æœåŠ¡

å¯æ‰‹åŠ¨æ‰§è¡Œæ›´æ–°ï¼š

/usr/local/bin/derper-autoupdate.sh

ğŸ§  å¸¸è§é—®é¢˜ FAQ

Q1ï¼šCloudflare å¼€äº†æ©™äº‘å¯ä»¥ç”¨å—ï¼Ÿ
âŒ ä¸è¡Œã€‚æ©™äº‘ä¼šä½¿ Letâ€™s Encrypt è¯ä¹¦ç”³è¯·å¤±è´¥ï¼Œè¯·è®¾ç½®ä¸ºç°äº‘ã€‚

Q2ï¼š443 ç«¯å£è¢«å ç”¨æ€ä¹ˆåŠï¼Ÿ
å¯ä»¥ç”¨ td ä¿®æ”¹ç›‘å¬ç«¯å£ï¼ˆå¦‚ 5443ï¼‰ã€‚

Q3ï¼šè¯ä¹¦åˆ°æœŸä¼šè‡ªåŠ¨ç»­ç­¾å—ï¼Ÿ
âœ… ä¼šã€‚--certmode letsencrypt è‡ªåŠ¨ç®¡ç†è¯ä¹¦ç­¾å‘ä¸ç»­æœŸã€‚

Q4ï¼šå¯ä»¥æ­é… Headscale ä½¿ç”¨å—ï¼Ÿ
âœ… å¯ä»¥ã€‚åªéœ€åœ¨ Headscale çš„é…ç½®æ–‡ä»¶ä¸­æ·»åŠ ä½ çš„ DERP èŠ‚ç‚¹åœ°å€ã€‚

ğŸ“œ License

MIT License Â© 2025 bobvane

â¤ï¸ è‡´ä¸ªäººç”¨æˆ·

æœ¬å·¥å…·å®Œå…¨å¼€æºã€æ— ä¾èµ–ã€æ— åé—¨ã€‚
å®ƒçš„æ„ä¹‰åœ¨äºè®©æ¯ä¸€ä¸ª Tailscale ç”¨æˆ·éƒ½èƒ½æ‹¥æœ‰ï¼š

è‡ªå·±æŒæ§çš„ä¸­ç»§èŠ‚ç‚¹ï¼›

æ— éœ€æ‹…å¿ƒå°é”æˆ–éšç§ï¼›

æ°¸ä¹…å…è´¹çš„ç½‘ç»œåŠ é€Ÿæ–¹æ¡ˆã€‚

ğŸŒ± ä¸€å° VPSï¼Œä¸€ä¸ªå‘½ä»¤ï¼Œä¸€æ¬¡éƒ¨ç½²ï¼Œå°±å¤Ÿäº†ã€‚
